exports.notifyNewTodo = functions.firestore .document("todos/{todoId}") .onCreate(async (snap, context) => { const data = snap.data(); // Взимаме всички потребители от Firestore const usersSnapshot = await admin.firestore().collection("users").get(); const emails = []; usersSnapshot.forEach(doc => { const userData = doc.data(); if (userData.email) emails.push(userData.email); }); const mailOptions = { from: "YOUR_EMAIL@gmail.com", bcc: emails, // изпраща до всички, без да виждат адресите си subject: "Нова задача е създадена", text: `Потребител ${data.createdByEmail} създаде нова задача:\n\n${data.text}` }; await transporter.sendMail(mailOptions); return true; });
